Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=e);e>n;n++)if(n in this&&this[n]===t)return n;return-1}),Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=[],o=arguments[1],a=0;n>a;a++)if(a in e){var i=e[a];t.call(o,i,a,e)&&r.push(i)}return r}),Object.defineProperty(Element.prototype,"classList",{get:function(){var t=this,e=t.className.split(" ");return e.add=function(){var n;for(i in arguments){n=!0;for(var r=0;r<e.length;r++)if(e[r]==arguments[i]){n=!1;break}n&&(t.className+=(t.className?" ":"")+arguments[i])}},e.remove=function(){t.className="";for(i in arguments)for(var n=0;n<e.length;n++)e[n]!=arguments[i]&&(t.className+=(t.className?" ":"")+e[n])},e},enumerable:!1});var extendFunctionality=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])};"undefined"!=typeof StaticNodeList&&(StaticNodeList.prototype.extend=extendFunctionality),Array.prototype.extend=extendFunctionality,Element.prototype.extend=extendFunctionality,Object.prototype.extend=extendFunctionality,Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys chamado de non-object");var a,i,s=[];for(a in o)t.call(o,a)&&s.push(a);if(e)for(i=0;r>i;i++)t.call(o,n[i])&&s.push(n[i]);return s}}());var App={version:"1.0",debug:!0,name:"Shortly Framework",state:"dev"};App.models={},App.initialize=function(t){void 0!==t&&t.dictionaryPath?(this.dictionary=new DataDictionary(t.dictionaryPath).mount(),this.initDictionary()):this.dictionary={},this.initComponentes()},App.changeLanguage=function(t){var e=new Date;e.setTime(+e+432e9),document.cookie="appLang="+t+"; expires="+e.toGMTString()+";",location.reload()},App.initDictionary=function(){var t=this.dictionary;for(var e in t)document.body.innerHTML=document.body.innerHTML.replace(new RegExp("{{App."+t[e].key+"}}","g"),t[e].value)},App.refreshDictionary=function(t){for(var e=this.dictionary,n=0;n<e.length;n++)"string"==typeof t?t=t.replace(new RegExp("{{App."+e[n].key+"}}","g"),e[n].value):"object"==typeof t&&(t.innerHTML=t.innerHTML.replace(new RegExp("{{App."+e[n].key+"}}","g"),e[n].value));return"string"==typeof t?t:void 0},App.setDataModel=function(t,e){this.models[t]=e},App.getDataModel=function(t){return this.models[t]},App.loadContentPrototype=function(t){var e;return sQuery.get({url:t,rAsync:!1,onSuccess:function(t){e=t.responseText},onError:function(t,e){console.log(t)}}),e},App.loadContent=function(t){var e=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");return null!=e?(e.open("GET",t,!1),e.send(),e.responseText):void window.console.log("AJAX (XMLHTTP) not supported.")},App.initComponentes=function(){this.components=new Component,this.components.alert.init(),this.components.table.init()};var DataDictionary=function(t){this.terms=[],this.defaultLang="pt",this.XMLPath=t};DataDictionary.prototype={mount:function(){for(var t=this.getFile(this.XMLPath,"XML"),e=t.getElementsByTagName("terms")[0].childNodes,n=0;n<e.length;n++){var r=e[n];1==r.nodeType&&(this.terms.push({key:r.attributes[0]?r.attributes[0].value:"",value:r.attributes[1]?r.attributes[1].value:"",lang:r.attributes[2]?r.attributes[2].value:this.defaultLang}),""===this.terms[this.terms.length-1].key&&this.terms.pop())}var o=this.defaultLang;if(""!=document.cookie){for(var a=document.cookie.split("; "),i=[],n=0;n<a.length;n++){var s=a[n].split("=");i[s[0]]=s[1]}o=i.appLang?i.appLang:this.defaultLang}for(var l=document.getElementById("slcLanguage"),n=0;n<l.options.length;n++)if(l.options[n].value==o){l.options[n].setAttribute("selected","selected");break}return this.terms.filter(function(t){return t.lang==o})},getFile:function(t,e){var n=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");return null!=n?(n.open("GET",t,!1),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&("XML"==e?callback=n.responseXML:callback=n.responseText)},n.send(),callback):void window.console.log("AJAX (XMLHTTP) not supported.")}};var Component=function(t,e){void 0!=t&&void 0!=e&&(this.get=this[t].create(e),this[t].init())};Component.prototype={alert:{create:function(t){if(t){var e;return e="<p ",e+=t.id?"id = '"+t.id+"' ":"",e+=t.tclass?"class='alert "+t.tclass+"' ":"class='alert'",e+=t.attr?t.attr:"",e+=">"+(t.content?t.content:"")+"<b class='alt-btn-close'></b></p>"}},init:function(){var t=SQ(".alert .alt-btn-close");void 0!=t&&t.on("click",this.close)},close:function(t){var e=t.target||t.srcElement;e.parentNode.parentNode.removeChild(e.parentNode)}},table:{mountByModel:function(t,e,n,r){n=n&&"true"==n?!0:!1;var o=(document.createElement("table"),document.createElement("tr"));o.setAttribute("class","tb-header");for(var a=[],i=0;i<t.length;i++){var s=document.createElement("tr"),l=Object.keys(t[i]);if(0==i&&!r){for(var c=0;c<l.length;c++){var d=document.createElement("td"),p=App.refreshDictionary("{{App."+e.charAt(0).toUpperCase()+e.slice(1)+"_"+l[c]+"}}");n?d.innerHTML=p+' <button class="table-sort" value="'+l[c]+'"></button>':d.innerHTML=p,o.appendChild(d)}a.push(o)}for(var c=0;c<l.length;c++){var d=document.createElement("td");d.innerHTML=t[i][l[c]],s.appendChild(d)}a.push(s)}return!r&&n&&SQ(a)[0].find(".table-sort").on("click",function(t){var e=t.target||t.srcElement,n=SQ(e.parentNode);SQ(e.parentNode.parentNode).find(".active")&&(SQ(e.parentNode.parentNode).find(".active").removeClass("active"),n.addClass("active")),n.toggleClass("active");var r=new Component;r.table.sort(e,e.value)}),a},init:function(){var t=this,e=SQ(".table");void 0!=e&&e.each(function(){for(;this.firstChild;)this.removeChild(this.firstChild);var e=this.getAttribute("data-model"),n=this.getAttribute("data-sort");if(e)for(var r=t.mountByModel(App.getDataModel(e),e,n),o=0;o<r.length;o++)this.appendChild(r[o])});var n=SQ(".table-search");void 0!=n&&n.each(function(){SQ(this).on("keyup",function(t){var e=t.target||t.srcElement,n=e.getAttribute("data-target");if(n){var r=SQ("#"+n),o=new Component;o.table.search(r,e.value)}})})},search:function(t,e){var n=this,r=SQ(t),o=r.getAttribute("data-model"),a=r.getAttribute("data-sort");if(o&&(filteredModel=App.getDataModel(o).filter(function(t){var n=Object.keys(t);isNaN(e)||(e=parseFloat(e));for(var r=0;r<n.length;r++){var o=n[r];if("string"==typeof t[o]){if(isNaN(e)&&t[o].search(new RegExp(e,"i"))>=0)return!0}else if(parseFloat(t[o])==e)return!0}return isNaN(e)&&"string"!=typeof e?!0:!1}),""==e&&(filteredModel=App.getDataModel(o)),r.dataModel=filteredModel,filteredModel.length>0)){r.find("tr").each(function(t,e){e.classList.indexOf("tb-header")<0&&e.remove()});for(var i=n.mountByModel(filteredModel,o,a,!0),s=0;s<i.length;s++)r.appendChild(i[s])}},sort:function(t,e){var n=this,r=SQ(t.parentNode.parentNode.parentNode),o=r.getAttribute("data-model"),a=r.getAttribute("data-sort");if(r.find("tr").each(function(t,e){e.classList.indexOf("tb-header")<0&&e.remove()}),o){var i=!0;SQ(t.parentNode).classList.indexOf("active"),SQ(t.parentNode).classList.indexOf("active")>=0?(i=!1,SQ(t).removeClass("order-desc")):SQ(t).addClass("order-desc");var s;if(s=r.dataModel?r.dataModel:App.getDataModel(o),filteredModel=s.sort(function(t,n){if(i){if(t[e]>n[e])return 1;if(t[e]<n[e])return-1}else{if(t[e]>n[e])return-1;if(t[e]<n[e])return 1}return 0}),filteredModel.length>0)for(var l=n.mountByModel(filteredModel,o,a,!0),c=0;c<l.length;c++)r.appendChild(l[c])}}}};
